{% extends "base.html" %}

{% block title %}
{% if site %}Edytuj obiekt – ALLSEC Portal{% else %}Nowy obiekt – ALLSEC Portal{% endif %}
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h4 mb-1">
      {% if site %}Edytuj obiekt{% else %}Nowy obiekt{% endif %}
    </h1>
    <p class="text-muted small mb-0">
      Uzupełnij dane obiektu: adres, dane fakturowe i informacje techniczne.
    </p>
  </div>
  <div>
    <a href="{% url 'core:site_list' %}" class="btn btn-sm btn-outline-secondary">
      ← Lista obiektów
    </a>
  </div>
</div>

<div class="card shadow-sm border-0">
  <div class="card-body">
    <form method="post" novalidate>
      {% csrf_token %}

      <div class="row">
        <div class="col-md-6">
          <div class="mb-2">
            <label class="form-label small">{{ form.entity.label }}</label>
            {{ form.entity }}
            {% if form.entity.errors %}
            <div class="text-danger small">{{ form.entity.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-2">
            <label class="form-label small">{{ form.manager.label }}</label>
            {{ form.manager }}
            {% if form.manager.errors %}
            <div class="text-danger small">{{ form.manager.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-2">
            <label class="form-label small">{{ form.name.label }}</label>
            {{ form.name }}
            {% if form.name.errors %}
            <div class="text-danger small">{{ form.name.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-2">
            <label class="form-label small">{{ form.site_type.label }}</label>
            {{ form.site_type }}
            {% if form.site_type.errors %}
            <div class="text-danger small">{{ form.site_type.errors|striptags }}</div>
            {% endif %}
          </div>
        </div>

        <div class="col-md-6">
          <div class="mb-2">
            <label class="form-label small">{{ form.street.label }}</label>
            {{ form.street }}
            {% if form.street.errors %}
            <div class="text-danger small">{{ form.street.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-2">
            <label class="form-label small">{{ form.postal_code.label }}</label>
            {{ form.postal_code }}
            {% if form.postal_code.errors %}
            <div class="text-danger small">{{ form.postal_code.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-2">
            <label class="form-label small">{{ form.city.label }}</label>
            {{ form.city }}
            {% if form.city.errors %}
            <div class="text-danger small">{{ form.city.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-2">
            <label class="form-label small">{{ form.google_maps_url.label }}</label>
            {{ form.google_maps_url }}
            {% if form.google_maps_url.errors %}
            <div class="text-danger small">{{ form.google_maps_url.errors|striptags }}</div>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="mb-2">
        <label class="form-label small">{{ form.access_info.label }}</label>
        {{ form.access_info }}
        {% if form.access_info.errors %}
        <div class="text-danger small">{{ form.access_info.errors|striptags }}</div>
        {% endif %}
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="card mb-3">
            <div class="card-header py-2">
              <strong>Konserwacje (harmonogram)</strong>
            </div>
            <div class="card-body p-3">
              <div class="mb-2">
                {{ form.maintenance_frequency.label_tag }}
                {{ form.maintenance_frequency }}
                {% if form.maintenance_frequency.help_text %}
                <small class="form-text text-muted">
                  {{ form.maintenance_frequency.help_text }}
                </small>
                {% endif %}
              </div>

              <div class="mb-2">
                {{ form.maintenance_start_month.label_tag }}
                {{ form.maintenance_start_month }}
                <small class="form-text text-muted">
                  Używane dla schematów: „co miesiąc”, „co kwartał”, „2x w roku”.
                </small>
              </div>

              <div class="mb-2">
                {{ form.maintenance_execution_month_in_period.label_tag }}
                {{ form.maintenance_execution_month_in_period }}
                <small class="form-text text-muted">
                  1 = pierwszy miesiąc okresu, 2 = drugi, 3 = trzeci itd.
                  Dla kwartalnych: 1–3. Dla 2x w roku: 1–6.
                </small>
                {% if form.maintenance_execution_month_in_period.errors %}
                <div class="text-danger small">
                  {{ form.maintenance_execution_month_in_period.errors|striptags }}
                </div>
                {% endif %}
              </div>

              <div class="mb-2">
                {{ form.maintenance_custom_months.label_tag }}
                {{ form.maintenance_custom_months }}
                {% if form.maintenance_custom_months.help_text %}
                <small class="form-text text-muted">
                  {{ form.maintenance_custom_months.help_text }}
                </small>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <div class="mb-2">
          <label class="form-label small">{{ form.technical_notes.label }}</label>
          {{ form.technical_notes }}
          {% if form.technical_notes.errors %}
          <div class="text-danger small">{{ form.technical_notes.errors|striptags }}</div>
          {% endif %}
        </div>



        <div class="mt-3 d-flex justify-content-between">
          <a href="{% url 'core:site_list' %}" class="btn btn-sm btn-outline-secondary">
            Anuluj
          </a>
          <button type="submit" class="btn btn-sm btn-primary">
            Zapisz
          </button>
        </div>
    </form>
  </div>
</div>
{% endblock %}