{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container my-3">
  <h3>Protokół konserwacji</h3>

  <div class="mb-3">
    <p class="mb-0"><strong>Obiekt:</strong> {{ site.name }}</p>
    <p class="mb-0">
      <strong>Adres:</strong>
      {% if site.street or site.postal_code or site.city %}
      {{ site.street }}, {{ site.postal_code }} {{ site.city }}
      {% else %}
      —
      {% endif %}
    </p>
    <p class="mb-0">
      <strong>Okres:</strong>
      {% if protocol.contract_period_display %}
      {{ protocol.contract_period_display }} (wg umowy)
      {% else %}
      —
      {% endif %}
    </p>
    <p class="mb-0">
      <strong>Wykonanie:</strong>
      {% if protocol.period_display %}
      {{ protocol.period_display }}
      {% else %}
      —
      {% endif %}
    </p>

    {% if protocol.next_period_display %}
    <p class="mb-0">
      <strong>Następny przegląd:</strong>
      {{ protocol.next_period_display }}
    </p>
    {% endif %}

    <p class="mb-0">
      <strong>Zlecenie:</strong> {{ work_order.title }} ({{ work_order.number }})
    </p>
  </div>

  <hr>

  {% for section in sections %}
  <div class="card mb-3">
    <div class="card-header">
      <strong>{{ section.header_name }}:</strong>
      {% if section.manufacturer or section.model %}
      {{ section.manufacturer }} {{ section.model }}
      {% endif %}
    </div>
    <div class="card-body">
      <p class="mb-1"><strong>Lokalizacja:</strong> {{ section.location|default:"—" }}</p>
      <p class="mb-1">
        <strong>Wynik sekcji:</strong>
        {% if section.section_result %}
        {{ section.get_section_result_display }}
        {% else %}
        —
        {% endif %}
      </p>

      <table class="table table-sm mt-3">
        <thead>
          <tr>
            <th style="width: 55%;">Czynność</th>
            <th style="width: 10%;">Wynik</th>
            <th style="width: 35%;">Tekst własny</th>
          </tr>
        </thead>
        <tbody>
          {% for item in section.check_items.all %}
          {% if item.active %}
          <tr>
            <td>{{ item.label }}</td>
            <td>
              {% if item.result %}
              {{ item.get_result_display }}
              {% else %}
              —
              {% endif %}
            </td>
            <td>{{ item.note|linebreaksbr }}</td>
          </tr>
          {% endif %}
          {% endfor %}
        </tbody>
      </table>

      <div class="mt-2">
        <strong>Uwagi (podsumowanie sekcji):</strong><br>
        {{ section.section_remarks|default:"—"|linebreaksbr }}
      </div>
    </div>
  </div>
  {% empty %}
  <p>Brak sekcji w tym protokole.</p>
  {% endfor %}
</div>
{% endblock %}