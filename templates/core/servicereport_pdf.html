{% load static %}
<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>{{ download_filename }}</title>
  <style>
   @page {
    size: A4;
    margin: 15mm 12mm;
  }

  body {
    font-family: DejaVu,Helvetica, sans-serif;
    font-size: 9pt;
    line-height: 1.3;
  }

  h1 {
    font-family: DejaVu-Bold, DejaVu,Helvetica, sans-serif;
    font-size: 14pt;
    margin: 0 0 3mm 0;
    
  }

  .small {
    font-size: 8pt;
  }

    .header-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 4mm;
    }

    .header-table td {
      vertical-align: top;
    }

    .header-left {
      width: 60%;
    }

    .header-right {
      width: 40%;
      text-align: right;
    }

    .header-logo {
      margin-bottom: 2mm;
    }

    .header-object {
      margin-top: 2mm;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    .box-table {
      margin-top: 2mm;
      margin-bottom: 2mm;
    }

    .box-table td {
      border: 0.5pt solid #000;
      padding: 2mm 2.5mm;
    }

    .box-table th {
      border: 0.5pt solid #000;
      padding: 1.5mm 2.5mm;
      text-align: left;
      font-size: 8pt;
      background-color: #f4f4f4;
    }

    .no-border td,
    .no-border th {
      border: none;
    }

    .label-cell {
      width: 30%;
      font-family: DejaVu-Bold, DejaVu, Helvetica, sans-serif;
      font-weight: normal;
      white-space: nowrap;
    }

    .value-cell {
      width: 70%;
    }

    .section-title {
      font-family: DejaVu-Bold, DejaVu, Helvetica, sans-serif;
      font-weight: normal;
      margin-top: 3mm;
      margin-bottom: 1mm;
      font-size: 9pt;
    }

    .multiline-box {
      border: 0.5pt solid #000;
      padding: 2mm 2.5mm;
      min-height: 18mm;
      white-space: pre-wrap;
    }

    .signatures-table {
      margin-top: 8mm;
    }

    .signatures-table td {
      text-align: center;
      padding-top: 10mm;
      font-size: 8pt;
    }

    .signatures-line {
      border-top: 0.5pt solid #000;
      width: 60mm;
      margin: 0 auto 1mm auto;
    }

    @media print {
    .no-print {
      display: none !important;
    }
  }
  </style>
</head>
<body>
<div class="no-print" style="margin: 10px 0;">
  <button type="button" onclick="window.print()">Drukuj / Zapisz jako PDF</button>
</div>
<div class="wrapper">

  {# ===== NAGŁÓWEK ===== #}
  <table class="no-border header-table">
    <tr>
      <td class="header-left">
        <img src="{% static 'img/logo2-150.jpg' %}" alt="ALLSEC" class="header-logo" />

        <h1>
          Protokół serwisowy
          {% if report.number %} nr: {{ report.number }}{% endif %}
        </h1>

        <div class="header-object small">
            <strong>Nazwa obiektu:</strong>
            {{ order.site.name }}<br/>
            <strong>Adres obiektu:</strong>
            {{ order.site.street }}
            {% if order.site.postcode %}, {{ order.site.postcode }}{% endif %}
            {{ order.site.city }}<br/><br/>
            {% if report.requester_name or report.requester_phone %}
                <span><strong>
                Zgłaszający:</strong>
                {% if report.requester_name %}{{ report.requester_name }}{% else %}brak danych{% endif %}
                {% if report.requester_phone %} ( {{ report.requester_phone }}{% endif %} )
                </span>
            {% endif %}
        </div>
      </td>

      <td class="header-right">
        <div class="small" style="margin-bottom: 3mm;">
          <strong>Data:</strong>
          {{ report.report_date|date:"d-m-Y" }}
        </div>
        <div class="small">
          <strong>ALLSEC Chmiel Michał</strong><br/>
          ul. Akacjowa 29/2<br/>
          83-331 Niestępowo<br/>
          NIP: 957-082-18-56<br/>
          <br/>
          <strong>Tel.: 514-514-236<br/>
          e-mail: biuro@allsec.pl</br></strong><br/>
          <strong>Tryb serwisu:</strong>
          {{ report.get_service_mode_display|default:"" }}<br/>
          <strong>Forma płatności:</strong>
          {{ report.get_payment_method_display|default:"" }}
        </div>
      </td>
    </tr>
  </table>

  

  {# ===== OPIS ZGŁOSZENIA / STAN PRZED ===== #}
  <div class="section-title">Opis zgłoszenia / stan przed</div>
  <div class="multiline-box">
    {{ report.description_before|linebreaksbr }}
  </div>

  {# ===== OPIS WYKONANYCH PRAC ===== #}
  <div class="section-title">Opis wykonanych prac</div>
  <div class="multiline-box">
    {{ report.work_performed|linebreaksbr }}
  </div>

  {# ===== POZYCJE PROTOKOŁU – ZESTAWIENIE ===== #}
  {% if items %}
    <h2 class="section-title" style="margin-top: 10mm; font-size: 11pt;">
      Pozycje protokołu serwisowego
    </h2>

    <table class="box-table" style="width: 100%; border-collapse: collapse; font-size: 9pt; margin-top: 2mm;">
      <thead>
        <tr>
          <th style="width: 5%;  padding: 4px; border: 1px solid #000;">Lp.</th>
          <th style="width: 45%; padding: 4px; border: 1px solid #000;">Opis pozycji</th>
          <th style="width: 8%;  padding: 4px; border: 1px solid #000; text-align: right;">Ilość</th>
          <th style="width: 8%;  padding: 4px; border: 1px solid #000;">Jm</th>
          <th style="width: 17%; padding: 4px; border: 1px solid #000; text-align: right;">Cena jedn. netto</th>
          <th style="width: 17%; padding: 4px; border: 1px solid #000; text-align: right;">Wartość netto</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr>
            <td style="padding: 3px; border: 1px solid #000; text-align: center;">
              {{ forloop.counter }}
            </td>
            <td style="padding: 3px; border: 1px solid #000;">
              {{ item.description|default_if_none:"" }}
            </td>
            <td style="padding: 3px; border: 1px solid #000; text-align: right;">
              {{ item.quantity|default_if_none:"" }}
            </td>
            <td style="padding: 3px; border: 1px solid #000;">
              {{ item.unit|default_if_none:"" }}
            </td>
            <td style="padding: 3px; border: 1px solid #000; text-align: right;">
              {{ item.unit_price|default_if_none:"" }}
            </td>
            <td style="padding: 3px; border: 1px solid #000; text-align: right;">
              {{ item.total_price|default_if_none:"" }}
            </td>
          </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <td colspan="5" style="padding: 3px; border: 1px solid #000; text-align: right; font-weight: bold;">
            Razem netto:
          </td>
          <td style="padding: 3px; border: 1px solid #000; text-align: right; font-weight: bold;">
            {{ items_total }}
          </td>
        </tr>
      </tfoot>
    </table>
  {% else %}
    <p style="margin-top: 10mm; font-size: 9pt;">
      Brak pozycji rozliczeniowych na protokole.
    </p>
  {% endif %}

</div>
</body>
</html>
